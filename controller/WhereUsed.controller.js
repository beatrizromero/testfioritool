sap.ui.define(["Coty/RawMaterial/Router","Coty/RawMaterial/util/Constants","Coty/RawMaterial/util/Services","Coty/RawMaterial/util/Commons","Coty/RawMaterial/util/DataManager"],function(e,t,a,r,s){"use strict";return e.extend("Coty.RawMaterial.controller.WhereUsed",{onInit:function(){this.getRouter().getRoute(t.WHEREUSED_VIEW).attachMatched(this.onMatchedRoute,this)},onMatchedRoute:function(){let e=[this.getView().getModel(t.DATAMODEL).getProperty("/MaterialSelected/RAWMATERIAL_NUMBER"),this.getView().getModel(t.DATAMODEL).getProperty("/MaterialSelected/VERSION")];this.getWhereUse(e)},getWhereUse:function(e){let a=this.getPromises(e);sap.ui.core.BusyIndicator.show();Promise.all(a).then(e=>{sap.ui.core.BusyIndicator.hide();let a=e[0].results.concat(e[1].results,e[2].results);this.getView().getModel(t.DATAMODEL).setProperty("/Ingredients",a)}).catch(e=>{sap.ui.core.BusyIndicator.hide();this.showErrorMessage(e)})},getPromises:function(e){let t=[];t.push(new Promise((t,a)=>{this.callServiceRawComposition(e,t,a)}));t.push(new Promise((t,a)=>{this.callServiceTpmFormulas(e,t,a)}));t.push(new Promise((t,a)=>{this.callServiceStandardFormulas(e,t,a)}));return t},callServiceRawComposition:function(e,r,s){sap.ui.core.BusyIndicator.show(0);let i=e=>{e.results.map(e=>{e.Type=t.RAW_TYPE;return e});r(e)};let o=e=>{s(e)};a.getRawComposition(e,i,o)},callServiceTpmFormulas:function(e,r,s){sap.ui.core.BusyIndicator.show(0);let i=e=>{e.results.map(e=>{e.Type=t.FORMULA_TYPE;return e});r(e)};let o=e=>{s(e)};a.getTpmFormulas(e,i,o)},callServiceStandardFormulas:function(e,r,s){sap.ui.core.BusyIndicator.show(0);let i=e=>{e.results.map(e=>{e.Type=t.FORMULA_TYPE;return e});r(e)};let o=e=>{s(e)};a.getStandardFormulas(e,i,o)},onPressMaterial:function(e){let a=e.getSource().getBindingContext(t.DATAMODEL).getPath();let r=this.getView().getModel(t.DATAMODEL).getProperty(a);if(r.COMPONENT_TYPE===t.RAW_TYPE){this.callServiceRawMaterial([r.RAWMATERIAL_NUMBER,r.VERSION]);return}this.navToFormulasApp(r)},callServiceRawMaterial:function(e){a.getRawMaterial(e).then(e=>{sap.ui.core.BusyIndicator.hide();this.getView().getModel(t.DATAMODEL).setProperty("/MaterialSelected",e.results[0]);this.navBack();sap.ui.getCore().getEventBus().publish(t.DETAIL_VIEW,"localNavigation",{})}).catch(e=>{sap.ui.core.BusyIndicator.hide();this.showErrorMessage(e)})},navToFormulasApp:function(e){this.saveDataSessionStorage();let a={Formula:e.FORMULATION_NAME?e.FORMULATION_NAME:e.ATPM_FORMULA_ID,Version:e.FORMULATION_REVISION?e.FORMULATION_REVISION:t.EMPTY,App:parseInt(this.getView().getModel(t.DATAMODEL).getProperty("/App"))+t.ONE,TargetView:t.TARGET_VIEW_DETAIL};let s=r.replaceParameters(t.APP_FORMULAS,[a.Formula,a.Version,t.TARGET_VIEW_DETAIL,a.App]);window.location.href=s},saveDataSessionStorage:function(){let e=this.getView().getModel(t.DATAMODEL);let a=e.getProperty("/App");let r=s.getSaveRestoreData(e.getData(),t.TARGET_VIEW_WHERE);let i=btoa(JSON.stringify(r));sessionStorage.setItem(t.SESSION_STORAGE_RAW+a,i);sessionStorage.setItem(t.RESTORE+a,true)},showErrorMessage:function(e){r.showMessage(this,sap.ui.core.ValueState.Error,sap.ui.core.ValueState.Error,r.errorSimpleMessage(this,e))},onBtnPressNavBack:function(){this.navBack()}})});